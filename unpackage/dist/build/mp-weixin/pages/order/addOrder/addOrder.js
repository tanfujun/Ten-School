(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/addOrder/addOrder"],{"105f":function(e,t,r){"use strict";r.r(t);var n=r("c32c"),a=r("a267");for(var o in a)"default"!==o&&function(e){r.d(t,e,(function(){return a[e]}))}(o);r("1dcc");var c,u=r("f0c5"),i=Object(u["a"])(a["default"],n["b"],n["c"],!1,null,"4a179054",null,!1,n["a"],c);t["default"]=i.exports},"1dcc":function(e,t,r){"use strict";var n=r("c107"),a=r.n(n);a.a},"5e6f":function(e,t,r){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=c(r("a34a")),o=c(r("64d0"));function c(e){return e&&e.__esModule?e:{default:e}}function u(e,t,r,n,a,o,c){try{var u=e[o](c),i=u.value}catch(d){return void r(d)}u.done?t(i):Promise.resolve(i).then(n,a)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function c(e){u(o,n,a,c,i,"next",e)}function i(e){u(o,n,a,c,i,"throw",e)}c(void 0)}))}}var d=e.importObject("voucher"),f=e.importObject("order"),s={data:function(){return{cart:[],deno:"",voucher_id:"",voucher_user_id:"",amount:"",remark:"",phone:""}},watch:{voucher_id:{handler:function(e){var t=this;return i(a.default.mark((function r(){var n;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!e){r.next=5;break}return r.next=3,d.getVoucherById(e);case 3:n=r.sent,t.deno=n.deno;case 5:case"end":return r.stop()}}),r)})))()}}},computed:{totalNum:function(){var e=0;return this.cart.forEach((function(t){e+=t.num})),e},totalPrice:function(){var e=0;this.cart.forEach((function(t){e+=t.price*t.num}));var t=e.toFixed(2);return this.deno&&(t-=this.deno,t<=0&&(t=0),t=t.toFixed(2)),t}},onLoad:function(e){var t=JSON.parse(e.cart);this.cart=t,console.log("cart:",t)},methods:{gotoRemark:function(){n.navigateTo({url:"/pages/order/remark/remark"})},gotoSelectCoupon:function(){n.navigateTo({url:"/pages/purchase/selectCoupon/selectCoupon"})},addOrder:function(){var e=this;return i(a.default.mark((function t(){var r,c,u,i,d,s;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.phone){t.next=20;break}return r=n.getStorageSync("openid"),c=(0,o.default)().format("YYYY")+(0,o.default)().unix(),u=(0,o.default)().format("YYYY-MM-DD HH:mm:ss"),i={user_id:r,code:c,amount:e.totalPrice,remark:e.remark,phone:e.phone,create_time:u},e.voucher_id&&(i.voucher_id=e.voucher_id),d=[],e.cart.forEach((function(e){d.push({order_code:c,good_id:e._id,actual_price:e.price,num:e.num})})),t.prev=8,t.next=11,f.createOrder(i,d,e.voucher_user_id);case 11:s=t.sent,200===s.status&&(n.showToast({title:"下单成功！"}),setTimeout((function(){n.navigateBack()}),1e3)),t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](8),n.showToast({title:"下单失败！",icon:"error"});case 18:t.next=21;break;case 20:n.showToast({title:"请输入手机号！",icon:"error"});case 21:case"end":return t.stop()}}),t,null,[[8,15]])})))()}}};t.default=s}).call(this,r("a9ff")["default"],r("543d")["default"])},a267:function(e,t,r){"use strict";r.r(t);var n=r("5e6f"),a=r.n(n);for(var o in n)"default"!==o&&function(e){r.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},c107:function(e,t,r){},c32c:function(e,t,r){"use strict";var n;r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return n}));var a=function(){var e=this,t=e.$createElement;e._self._c},o=[]},e0ed:function(e,t,r){"use strict";(function(e){r("1aaf"),r("a9ff");n(r("66fd"));var t=n(r("105f"));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=r,e(t.default)}).call(this,r("543d")["createPage"])}},[["e0ed","common/runtime","common/vendor"]]]);